<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>MintLib - Your Book Trading Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .book-card {
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            flex: 0 0 300px;
            min-width: 300px;
        }
        
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .book-cover-container {
            position: relative;
            height: 350px;
        }
        
        .book-info {
            padding: 2rem;
        }
        
        .book-title {
            font-size: 1.3rem;
        }
        
        .book-author {
            font-size: 1.05rem;
        }
        
        .book-price {
            font-size: 1.4rem;
        }
        
        .carousel-container {
            position: relative;
            width: 100%;
            overflow: hidden;
        }
        
        .carousel-wrapper {
            display: flex;
            gap: 2rem;
            overflow: hidden;
            padding: 1rem 0;
            flex-wrap: nowrap;
        }
        
        .carousel-track {
            display: flex;
            gap: 2rem;
            animation: scroll-infinite 30s linear infinite;
        }
        
        .carousel-track:hover {
            animation-play-state: paused;
        }
        
        @keyframes scroll-infinite {
            0% {
                transform: translateX(0);
            }
            100% {
                transform: translateX(-50%);
            }
        }
        
        .carousel-wrapper::-webkit-scrollbar {
            display: none;
        }
        
        .carousel-controls {
            display: none;
        }
        
        .carousel-btn {
            display: none;
        }
        
        .carousel-dots {
            display: none;
        }
    </style>
</head>

<body>
    <header class="site-header">
        <div class="container header-inner">
            <a href="index.html" class="logo">
                <span class="logo-icon">üìö</span> MintLib
            </a>
            <nav class="main-nav" id="mainNav">
                <a href="about.html" class="nav-link">About Us</a>
                <a href="books.html" class="nav-link">Browse Books</a>
                <a href="sell.html" class="nav-link">Sell</a>
                <a href="cart.html" class="nav-link">Cart</a>
                <a href="my-orders.html" class="nav-link">My Orders</a>
                <a href="profile.html" class="nav-link">Profile</a>
                <a href="login.html" class="nav-link">Login</a>
            </nav>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="container">
                <div class="hero-content">
                    <div class="hero-badge">
                        <span>‚ú®</span> Trusted by Book Lovers Worldwide
                    </div>
                    <h1 class="hero-title">Your One Stop Shop For Trading Used Books</h1>
                    <p class="hero-subtitle">Discover, trade, and fall in love with books again. You won't find a better place for your literary adventures.</p>
                    <div class="hero-actions">
                        <a href="sell.html" class="btn btn-primary">Sell Your Book</a>
                        <a href="books.html" class="btn btn-secondary">Browse Collection</a>
                    </div>
                </div>
            </div>
        </section>

        <section class="features">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Why Choose MintLib?</h2>
                    <p class="section-subtitle">We make book trading simple, secure, and rewarding for everyone</p>
                </div>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">üîç</div>
                        <h3>Quick Search</h3>
                        <p>Find your books in the most efficient way possible with our advanced search and filtering system.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">‚úÖ</div>
                        <h3>Book Condition Check</h3>
                        <p>We check your books' condition then add a value based on the condition of said books to ensure fair pricing.</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üöö</div>
                        <h3>Efficient Delivery</h3>
                        <p>Delivery carrier receives book(s), then sends them to you or the person who bought your book(s) quickly and safely.</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="books" id="books">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Browse Books</h2>
                    <p class="section-subtitle">Discover books from our community</p>
                </div>

                <div class="carousel-container">
                    <div id="bookGrid" class="carousel-wrapper">
                        <div style="text-align: center; padding: 3rem; width: 100%;">
                            Loading books...
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>MintLib</h3>
                    <p>Your trusted platform for trading used books. Connecting book lovers worldwide.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="sell.html">Sell Books</a></li>
                        <li><a href="contact.html">Contact</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Support</h3>
                    <ul class="footer-links">
                        <li><a href="help.html">Help Center</a></li>
                        <li><a href="shipping.html">Shipping Info</a></li>
                        <li><a href="returns.html">Returns</a></li>
                        <li><a href="privacy.html">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>MintLib ¬© 2025 - All Rights Reserved</p>
            </div>
        </div>
    </footer>

    <script src="js/api/config.js"></script>
    <script>
        let allBooks = [];

        // Update navbar based on user role
        function updateNavbar() {
            const userData = JSON.parse(localStorage.getItem('user'));
            const nav = document.getElementById('mainNav');

            if (userData && userData.role === 'administrator') {
                nav.innerHTML = `
                    <a href="manage book.html" class="nav-link">Manage Books</a>
                    <a href="manage-orders.html" class="nav-link">Manage Orders</a>
                    <a href="manage user.html" class="nav-link">Manage Users</a>
                    <a href="manage-categories.html" class="nav-link">Categories</a>
                    <a href="profile.html" class="nav-link">Profile</a>
                `;
            } else if (userData) {
                nav.innerHTML = `
                    <a href="about.html" class="nav-link">About Us</a>
                    <a href="books.html" class="nav-link">Browse Books</a>
                    <a href="sell.html" class="nav-link">Sell</a>
                    <a href="cart.html" class="nav-link">Cart</a>
                    <a href="my-orders.html" class="nav-link">My Orders</a>
                    <a href="profile.html" class="nav-link">Profile</a>
                `;
            }
        }

        async function loadBooks() {
            console.log('Loading books from database...');
            const result = await apiCall('/books', 'GET');
            console.log('Books result:', result);

            if (result.success && result.data) {
                allBooks = result.data;
                displayBooks(allBooks);
            } else {
                displayNoBooks();
            }
        }

        function displayBooks(books) {
            const bookGrid = document.getElementById('bookGrid');

            if (books.length > 0) {
                // For infinite scroll, we need to duplicate books multiple times
                const track = document.createElement('div');
                track.className = 'carousel-track';

                // Duplicate books 3 times for seamless infinite scroll
                const infiniteBooks = [...books, ...books, ...books];

                infiniteBooks.forEach(book => {
                    const bookCard = document.createElement('div');
                    bookCard.className = 'book-card';
                    bookCard.onclick = () => window.location.href = `book details.html?id=${book._id}`;

                    const statusClass = book.condition === 'New' || book.condition === 'Like New' ? 'new' : '';

                    bookCard.innerHTML = `
                        <div class="book-cover-container">
                            <div class="book-cover">
                                <img src="${book.image}" alt="${book.title}" 
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div class="book-cover-placeholder" style="display: none;">${book.title}</div>
                            </div>
                            <div class="book-status ${statusClass}">${book.condition}</div>
                        </div>
                        <div class="book-info">
                            <h3 class="book-title">${book.title}</h3>
                            <p class="book-author">${book.author}</p>
                            <p class="book-author" style="font-size: 0.85rem; color: #6366f1;">üìÇ ${book.category}</p>
                            <div class="book-meta">
                                <span class="book-price">${book.price} EGP</span>
                                <div class="book-actions">
                                    <button class="action-btn" onclick="event.stopPropagation(); addToCartQuick('${book._id}', '${book.title}', '${book.author}', ${book.price}, '${book.image}')">
                                        Add to Cart
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;

                    track.appendChild(bookCard);
                });

                bookGrid.innerHTML = '';
                bookGrid.appendChild(track);
            } else {
                displayNoBooks();
            }
        }

        function displayNoBooks() {
            const bookGrid = document.getElementById('bookGrid');
            bookGrid.innerHTML = `
                <div style="text-align: center; padding: 3rem; grid-column: 1/-1;">
                    <p>No books available at the moment.</p>
                    <p style="margin-top: 1rem;">
                        <a href="sell.html" class="btn btn-primary">Be the first to sell a book!</a>
                    </p>
                </div>
            `;
        }

        async function addToCartQuick(bookId, title, author, price, image) {
            const token = localStorage.getItem('token');

            if (!token) {
                alert('Please login to add items to cart');
                window.location.href = 'login.html';
                return;
            }

            const result = await apiCall('/cart/add', 'POST', {
                productId: bookId,
                quantity: 1,
                price: price,
                title: title,
                author: author,
                image: image
            });

            if (result.success) {
                alert('Book added to cart!');
            } else {
                alert('Failed to add to cart: ' + result.message);
            }
        }

        document.addEventListener('DOMContentLoaded', async() => {
            updateNavbar();
            await loadBooks();
        });
    </script>
    <script src="script.js"></script>
</body>

</html>
