<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sell Your Book - MintLib</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>
<body>
<header class="site-header">
<div class="container header-inner">
<a href="index.html" class="logo">ðŸ“š MintLib</a>
<nav class="main-nav">
<a href="about.html">About Us</a>
<a href="cart.html" class="contact-link">Cart</a>
<a href="my-orders.html" class="contact-link">My Orders</a>
<a href="profile.html" class="contact-link">Profile</a>
</nav>
</div>
</header>

<main class="container">
<h1>Sell Your Book</h1>
<p style="margin-bottom: 2rem; color: #64748b;">Submit your book for review. Our team will approve it before it appears on the marketplace.</p>

<form id="sellForm" class="sell-form">
<label>Book Title:</label>
<input type="text" id="bookTitle" required><br>

<label>Book Author:</label>
<input type="text" id="bookAuthor" required><br>

<label>Book Category:</label>
<select id="bookCategory" required>
<option value="">-- Select a category --</option>
</select><br>

<label>Book Description:</label>
<textarea id="bookDescription" rows="4" placeholder="Describe your book..." required></textarea><br>

<label>Requested Price (in EGP):</label>
<input type="number" id="bookPrice" min="1" required><br>

<label>Book Cover Image URL:</label>
<input type="text" id="bookImage" placeholder="images/mybook.jpg or leave empty for default"><br>
<small style="color: #64748b;">Note: For now, please provide an image path.</small><br>

<label>Book Condition:</label>
<select id="bookCondition" required>
<option value="New">New</option>
<option value="Like New">Like New</option>
<option value="Used">Used</option>
</select><br>

<label>Stock Quantity:</label>
<input type="number" id="bookStock" value="1" min="1" required><br><br>

<button type="submit" class="btn">Submit for Approval</button>
</form>

<p id="sellMessage" class="message"></p>
</main>

<footer class="site-footer">
<div class="container">
<p>MintLib Â© 2025 - All Rights Reserved</p>
<p><a href="contact.html">Contact Us</a></p>
</div>
</footer>

<script src="js/api/config.js"></script>
<script>
async function loadCategories() {
    const result = await apiCall('/categories', 'GET');
    
    if (result.success && result.data) {
        const categorySelect = document.getElementById('bookCategory');
        
        result.data.forEach(category => {
            const option = document.createElement('option');
            option.value = category.name;
            option.textContent = `${category.icon} ${category.name}`;
            categorySelect.appendChild(option);
        });
    }
}

document.getElementById('sellForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const message = document.getElementById('sellMessage');
    message.textContent = 'Submitting your book for approval...';
    message.className = 'message';
    
    const token = localStorage.getItem('token');
    if (!token) {
        message.className = 'error-message';
        message.textContent = 'âŒ Please login first to sell a book';
        setTimeout(() => {
            window.location.href = 'login.html';
        }, 2000);
        return;
    }
    
    const bookData = {
        title: document.getElementById('bookTitle').value,
        author: document.getElementById('bookAuthor').value,
        category: document.getElementById('bookCategory').value,
        description: document.getElementById('bookDescription').value,
        price: parseFloat(document.getElementById('bookPrice').value),
        image: document.getElementById('bookImage').value || 'images/default-book.jpg',
        condition: document.getElementById('bookCondition').value,
        stock: parseInt(document.getElementById('bookStock').value)
    };
    
    const result = await apiCall('/books', 'POST', bookData);
    
    if (result.success) {
        message.className = 'success-message';
        message.textContent = 'âœ… Book submitted successfully! It will appear on the marketplace once an admin approves it.';
        
        document.getElementById('sellForm').reset();
        
        setTimeout(() => {
            window.location.href = 'index.html';
        }, 3000);
    } else {
        message.className = 'error-message';
        message.textContent = 'âŒ ' + (result.message || 'Failed to submit book.');
    }
});

document.addEventListener('DOMContentLoaded', () => {
    const token = localStorage.getItem('token');
    if (!token) {
        const message = document.getElementById('sellMessage');
        message.className = 'error-message';
        message.textContent = 'âš ï¸ You need to be logged in to sell books. Redirecting...';
        setTimeout(() => {
            window.location.href = 'login.html';
        }, 2000);
        return;
    }
    
    loadCategories();
});
</script>
<script src="script.js"></script>
</body>
</html>
